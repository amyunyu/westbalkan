<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西巴爾幹之旅 App</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- 引入 Babel (用於解析 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFCF8;
        }
        .font-serif {
            font-family: 'Noto Serif TC', serif;
        }
        /* Custom Scrollbar */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Animation */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, Fragment } = React;

        // --- Icon Component System ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                MapPin: (
                    <Fragment>
                        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </Fragment>
                ),
                Calendar: (
                    <Fragment>
                        <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                        <line x1="16" x2="16" y1="2" y2="6"/>
                        <line x1="8" x2="8" y1="2" y2="6"/>
                        <line x1="3" x2="21" y1="10" y2="10"/>
                    </Fragment>
                ),
                Clock: (
                    <Fragment>
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </Fragment>
                ),
                ChevronLeft: <path d="m15 18-6-6 6-6"/>,
                Plane: (
                    <Fragment>
                        <path d="M2 12h5"/>
                        <path d="M13 5.74V3a2 2 0 0 0-3.56-1.47l-1.56 2.08"/>
                        <path d="M16 12h6"/>
                        <path d="M13 18.26V21a2 2 0 0 1-3.56 1.47l-1.56-2.08"/>
                        <path d="M20 14h2a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2h-2"/>
                        <path d="M7 17a2 2 0 0 0 1.5-3.5L16 6l4 4-7.5 7.5A2 2 0 0 0 7 17Z"/>
                    </Fragment>
                ),
                Car: (
                    <Fragment>
                        <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/>
                        <circle cx="7" cy="17" r="2"/>
                        <path d="M9 17h6"/>
                        <circle cx="17" cy="17" r="2"/>
                    </Fragment>
                ),
                Info: (
                    <Fragment>
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                    </Fragment>
                ),
                Sun: (
                    <Fragment>
                        <circle cx="12" cy="12" r="4"/>
                        <path d="M12 2v2"/>
                        <path d="M12 20v2"/>
                        <path d="m4.93 4.93 1.41 1.41"/>
                        <path d="m17.66 17.66 1.41 1.41"/>
                        <path d="M2 12h2"/>
                        <path d="M20 12h2"/>
                        <path d="m6.34 17.66-1.41 1.41"/>
                        <path d="m19.07 4.93-1.41 1.41"/>
                    </Fragment>
                ),
                CloudRain: (
                    <Fragment>
                        <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/>
                        <path d="M16 14v6"/>
                        <path d="M8 14v6"/>
                        <path d="M12 16v6"/>
                    </Fragment>
                ),
                Cloud: (
                    <Fragment>
                        <path d="M17.5 19c0-1.7-1.3-3-3-3"/>
                        <path d="M9 19c-3.3 0-6-2.7-6-6 0-3.3 2.7-6 6-6 1.5 0 2.9.5 4.1 1.4"/>
                        <path d="M19 13.5A2.5 2.5 0 0 1 16.5 16H9"/>
                    </Fragment>
                ),
                Camera: (
                    <Fragment>
                        <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                        <circle cx="12" cy="13" r="3"/>
                    </Fragment>
                ),
                Coffee: (
                    <Fragment>
                        <path d="M17 8h1a4 4 0 1 1 0 8h-1"/>
                        <path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/>
                        <line x1="6" x2="6" y1="1" y2="4"/>
                        <line x1="10" x2="10" y1="1" y2="4"/>
                        <line x1="14" x2="14" y1="1" y2="4"/>
                    </Fragment>
                ),
                Utensils: (
                    <Fragment>
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/>
                        <path d="M7 2v20"/>
                        <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>
                    </Fragment>
                ),
                BedDouble: (
                    <Fragment>
                        <path d="M2 20v-8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v8"/>
                        <path d="M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4"/>
                        <path d="M12 4v6"/>
                        <path d="M2 18h20"/>
                    </Fragment>
                ),
                Star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>,
                Compass: (
                    <Fragment>
                        <circle cx="12" cy="12" r="10"/>
                        <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/>
                    </Fragment>
                ),
                ArrowRight: (
                    <Fragment>
                        <path d="M5 12h14"/>
                        <path d="m12 5 7 7-7 7"/>
                    </Fragment>
                )
            };

            const content = icons[name] || null;

            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                >
                    {content}
                </svg>
            );
        };

        // --- Data & Configuration ---

        const MORANDI_COLORS = {
            bg: 'bg-[#FDFCF8]', 
            primary: 'bg-[#8F9E9D]', 
            secondary: 'bg-[#D4C4B7]', 
            accent: 'bg-[#E6DECA]', 
            text: 'text-[#4A4A4A]', 
            textLight: 'text-[#8C8C8C]',
            card: 'bg-white',
            highlight: 'text-[#C78F76]' 
        };

        const getWeather = (dayIndex) => {
            const weathers = [
                { temp: 24, icon: "Sun", color: "text-yellow-500", desc: '晴朗' },
                { temp: 22, icon: "Cloud", color: "text-gray-400", desc: '多雲' },
                { temp: 26, icon: "Sun", color: "text-orange-400", desc: '艷陽' },
                { temp: 20, icon: "CloudRain", color: "text-blue-400", desc: '午後陣雨' },
            ];
            return weathers[dayIndex % weathers.length];
        };

        const generateDates = () => {
            const dates = [];
            const start = new Date(2026, 4, 24); 
            const end = new Date(2026, 5, 12);   
            
            let current = start;
            let dayCount = 1;

            while (current <= end) {
                dates.push({
                    dateObj: new Date(current),
                    dayNum: dayCount,
                    dayString: `${current.getMonth() + 1}/${current.getDate()}`,
                    weekDay: current.toLocaleDateString('zh-TW', { weekday: 'short' })
                });
                current.setDate(current.getDate() + 1);
                dayCount++;
            }
            return dates;
        };

        const tripDates = generateDates();

        // Helper for inline map button (The "Raindrop")
        const MapLink = ({ url }) => (
            <a 
                href={url}
                target="_blank"
                rel="noreferrer"
                className={`inline-flex items-center justify-center ml-2 p-1 rounded-full ${MORANDI_COLORS.bg} text-[#C78F76] hover:bg-[#FFF] border border-gray-200 transition-colors align-bottom cursor-pointer`}
                style={{ verticalAlign: 'middle' }}
                onClick={(e) => e.stopPropagation()}
            >
                <div className="w-3 h-3 flex items-center justify-center rounded-tr-[50%] rounded-tl-[50%] rounded-bl-[50%] rounded-br-0 transform rotate-45 border border-current">
                     <div className="w-0.5 h-0.5 bg-current rounded-full transform -rotate-45" />
                </div>
            </a>
        );

        const itineraryData = {
            1: [ 
                {
                    id: 'd1-1',
                    time: '18:30',
                    title: '前往機場',
                    type: 'transport',
                    iconName: 'Plane',
                    location: '桃園國際機場',
                    desc: '準備出發前往西巴爾幹半島！建議提早3小時抵達機場辦理登機手續。',
                    tips: ['檢查電源轉接頭', '下載離線地圖', '攜帶頸枕']
                },
                {
                    id: 'd1-2',
                    time: '21:00',
                    title: '飛往杜布羅夫尼克',
                    type: 'transport',
                    iconName: 'Plane',
                    subtitle: '轉機',
                    location: '伊斯坦堡機場 (轉機)',
                    desc: '長途飛行，請多補充水分。預計在伊斯坦堡轉機。',
                    tips: ['機上保濕', '調整手錶時差']
                }
            ],
            2: [ 
                {
                    id: 'd2-1',
                    time: '14:00',
                    title: '租車',
                    type: 'transport',
                    iconName: 'Car',
                    location: 'Zagreb Airport',
                    mapLink: 'https://maps.app.goo.gl/zEc8CPN39NLXcLzf6',
                    subtitle: '機場取車',
                    desc: '辦理租車手續，準備開始西巴爾幹半島的自駕之旅。請務必詳細檢查車況及保險文件。',
                    tips: ['準備國際駕照', '確認油箱返還規定', '檢查車身刮痕']
                },
                {
                    id: 'd2-2',
                    time: '15:30',
                    title: 'Olive Tree City Corner',
                    type: 'hotel',
                    iconName: 'BedDouble',
                    subtitle: 'Booking/check in',
                    location: 'Olive Tree City Corner, Zagreb',
                    mapLink: 'https://maps.app.goo.gl/T6FTVhCTjEoCbxdu6',
                    desc: '抵達今日住宿地點辦理入住手續，稍作休息。',
                    tips: ['確認停車位置', '詢問房東當地推薦']
                },
                {
                    id: 'd2-3',
                    time: '16:30',
                    title: '札格瑞布舊城漫遊',
                    type: 'sightseeing',
                    iconName: 'Camera',
                    subtitle: '主教座堂、石門、聖馬爾谷教堂',
                    location: 'Zagrebačka katedrala',
                    mapLink: 'https://maps.app.goo.gl/7EzQcsDABBNFR2JQ8',
                    desc: (
                        <Fragment>
                            <p className="mb-4 text-gray-600 leading-relaxed text-justify">漫步於札格瑞布上城區，探索三大歷史地標：</p>

                            <div className="mb-6">
                                <h4 className="font-bold text-gray-800 mb-1 flex items-center">
                                    【札格瑞布主教座堂】 
                                    <MapLink url="https://maps.app.goo.gl/LUBdDPyV9ESCDgyM8" />
                                </h4>
                                <ul className="text-sm text-gray-600 space-y-1 list-none pl-0">
                                    <li>1. 克羅埃西亞最高、最具代表性的哥德式地標：擁有雙尖塔，是 Zagreb 天際線最顯眼的建築，但因 2020 地震受損，目前仍在修復（外觀部分有鷹架）。</li>
                                    <li>2. 教堂歷史超過八百年，是首都最重要宗教中心：內部以哥德式拱頂、彩繪玻璃與雕刻聞名；地震後雖可能僅部分開放，但仍值得一訪。</li>
                                    <li>3. 外觀拍照非常壯觀，周邊廣場也適合停留：廣場空間大，適合拍整體建築；若想拍上城全景，可在同一天搭 Funicular 去塔上補景。</li>
                                </ul>
                            </div>

                            <div className="mb-6">
                                <h4 className="font-bold text-gray-800 mb-1 flex items-center">
                                    【石門】
                                    <MapLink url="https://maps.app.goo.gl/eN9HqDhoKveSN28d6" />
                                </h4>
                                <ul className="text-sm text-gray-600 space-y-1 list-none pl-0">
                                    <li>1. 上城僅存的中世紀城門，城市重要歷史遺址：原本是城牆的一部分，13 世紀建成，是 Zagreb 少數保留至今的城門。</li>
                                    <li>2. 門內供奉奇蹟聖母畫像，被視為守護 Zagreb 的象徵：據說 1731 大火中所有物品燒毀，只有聖母畫像完好無損，因此成為市民重要的祈願地點。</li>
                                    <li>3. 氣氛寧靜、帶有神聖感，可短暫停留點蠟燭：遊客多是靜靜經過、拍照或祈願；參觀免費，行程可在 5–10 分鐘內完成。</li>
                                </ul>
                            </div>

                            <div className="mb-4">
                                <h4 className="font-bold text-gray-800 mb-1 flex items-center">
                                    【聖馬爾谷教堂】
                                    <MapLink url="https://maps.app.goo.gl/kh5qDiZeJnayCNBJ7" />
                                </h4>
                                <ul className="text-sm text-gray-600 space-y-1 list-none pl-0">
                                    <li>1. Zagreb 的視覺標誌，以彩色瓷磚屋頂最具代表性：屋頂圖案呈現 克羅埃西亞國徽 + Zagreb 市徽，拍照非常亮眼，是必訪地標。</li>
                                    <li>2. 位於上城最古老區域，周邊是國會與政府機構：聖馬爾谷廣場周邊開闊、典雅，是 Zagreb 政治中心與歷史重心。</li>
                                    <li>3. 建築本體為羅馬式＋哥德式混合風格：內部偶爾開放（不固定），但外觀本身就相當值得欣賞；建議白天拍一次、傍晚光線下再看一次更漂亮。</li>
                                </ul>
                            </div>
                        </Fragment>
                    ),
                    tips: ['穿著舒適好走的鞋', '石門為肅靜場所請保持安靜', '教堂內部參觀需注意開放時間']
                }
            ],
            3: [
                {
                    id: 'd3-1',
                    time: '09:00',
                    title: '早餐',
                    type: 'food',
                    iconName: 'Coffee',
                    location: 'Zagreb',
                    desc: '享受美好的早餐時光，為新的一天補充滿滿活力。',
                    tips: []
                },
                {
                    id: 'd3-combined',
                    time: '10:00',
                    title: '札格瑞布下城漫步',
                    type: 'sightseeing',
                    iconName: 'Camera',
                    subtitle: 'Zrinjevac、國王噴泉、總督廣場',
                    location: 'Zrinjevac Park, Zagreb',
                    mapLink: 'https://maps.app.goo.gl/MBA9ahmZafFHqB2Y7', // Primary link (Zrinjevac)
                    desc: (
                        <Fragment>
                            <p className="mb-4 text-gray-600 leading-relaxed text-justify">在前往多拉茨市場前，先來一場愜意的下城區（Donji Grad）巡禮，感受札格瑞布的城市脈動：</p>

                            <div className="mb-6">
                                <h4 className="font-bold text-gray-800 mb-1 flex items-center">
                                    【Zrinjevac Park】 
                                    <MapLink url="https://maps.app.goo.gl/MBA9ahmZafFHqB2Y7" />
                                </h4>
                                <p className="text-sm text-gray-600 leading-relaxed">
                                    正式名稱為 Nikola Šubić Zrinski 廣場，是札格瑞布著名的「綠色馬蹄」（Green Horseshoe）公園序列的一部分。公園中心有一座建於1891年的音樂涼亭，四周環繞著百年懸鈴木與噴泉，是當地人最愛的休憩場所，氛圍優雅浪漫。
                                </p>
                            </div>

                            <div className="mb-6">
                                <h4 className="font-bold text-gray-800 mb-1 flex items-center">
                                    【托米斯拉夫國王噴泉】
                                    <MapLink url="https://maps.app.goo.gl/n4DVFc5MyALF2pJx9" />
                                </h4>
                                <p className="text-sm text-gray-600 leading-relaxed">
                                    位於火車總站正對面的宏偉廣場（King Tomislav Square）。廣場上矗立著克羅埃西亞第一位國王托米斯拉夫（King Tomislav）的騎馬雕像，紀念他在925年加冕的歷史時刻。雕像後方是黃色的藝術展覽館（Art Pavilion），展現了華麗的新藝術風格。
                                </p>
                            </div>

                            <div className="mb-4">
                                <h4 className="font-bold text-gray-800 mb-1 flex items-center">
                                    【耶拉契奇總督廣場】
                                    <MapLink url="https://www.google.com/maps/search/?api=1&query=Ban+Jelačić+Square" />
                                </h4>
                                <p className="text-sm text-gray-600 leading-relaxed">
                                    札格瑞布的地理中心與主廣場，連接著上城與下城。廣場中央是19世紀總督 Josip Jelačić 的騎馬雕像，他是克羅埃西亞的民族英雄。這裡是市民最熱門的會面點，周邊建築融合了古典主義、分離派與現代主義風格。由此處走上階梯，只需約1分鐘即可抵達多拉茨市場。
                                </p>
                            </div>
                        </Fragment>
                    ),
                    tips: ['此路線為平緩的步行區域，非常輕鬆', '沿途有許多適合拍照的角落', '廣場人潮較多請留意隨身物品']
                },
                {
                    id: 'd3-5',
                    time: '10:50',
                    title: '多拉茨市場',
                    type: 'shopping',
                    iconName: 'Utensils',
                    subtitle: 'Dolac Market',
                    location: 'Dolac Market',
                    mapLink: 'https://maps.app.goo.gl/fqnhjcCdCPA8VhrE8',
                    desc: '札格瑞布最著名的「紅傘市場」，充滿鮮豔的紅色遮陽傘。這裡是在地人的廚房，也是體驗當地生活的最佳去處。建議可以購買新鮮水果、蜂蜜，並拍攝經典的紅傘場景。',
                    tips: ['市集是現金/部分攤販可刷卡，建議帶一些歐元小額鈔票', '水果可以請店家「幫你挑一盒好吃的」', '推薦邊走邊吃：葡萄、櫻桃、無花果', 'Dolac Market 很安全，但旅遊區仍注意包包']
                },
                {
                    id: 'd3-6',
                    time: '11:30',
                    title: '搭乘登山纜車',
                    type: 'activity',
                    iconName: 'Compass',
                    subtitle: 'Funicular',
                    location: 'Zagreb Funicular',
                    desc: '被譽為世界上最短的公共交通纜車之一，連接著下城區與上城區。纜車站就在市場旁東南側，下坡步行約 3 分鐘可到。',
                    tips: ['車程很短但體驗獨特', '亦可選擇步行上山']
                },
                {
                    id: 'd3-7',
                    time: '11:32',
                    title: '洛特爾薩克塔',
                    type: 'sightseeing',
                    iconName: 'Camera',
                    subtitle: '警盜鐘之塔',
                    location: 'Lotrščak Tower',
                    mapLink: 'https://maps.app.goo.gl/b261uivUK7pmrhi79',
                    desc: '位於上城區的入口處，擁有絕佳的視野。若有興趣可以購票登塔，拍攝札格瑞布的城市全景。',
                    tips: []
                },
                {
                    id: 'd3-8',
                    time: '12:00',
                    title: '聽正午大炮',
                    type: 'activity',
                    iconName: 'Clock',
                    subtitle: 'Grič Cannon',
                    location: 'Lotrščak Tower',
                    desc: '每天正午十二點，這裡會準時鳴響加農砲（Grič Cannon），這是札格瑞布延續百年的傳統，以此校正全城的鐘錶時間。聲音非常響亮，請做好心理準備！',
                    tips: ['聲音很大，建議摀住耳朵', '就在 Lotrščak Tower 旁']
                },
                {
                    id: 'd3-9',
                    time: '12:15',
                    title: '午餐',
                    type: 'food',
                    iconName: 'Utensils',
                    location: 'Tkalčićeva Street',
                    desc: '建議在 Tkalčićeva 街或主廣場附近用餐，這一帶聚集了許多餐廳、咖啡館與酒吧，選擇非常豐富。',
                    tips: []
                },
                {
                    id: 'd3-10',
                    time: '14:30',
                    title: '前往 Ljubljana',
                    type: 'transport',
                    iconName: 'Car',
                    subtitle: '開車離開 Zagreb',
                    location: 'Ljubljana, Slovenia',
                    desc: '開車離開札格瑞布 (Zagreb)，前往斯洛維尼亞首都盧布爾雅那 (Ljubljana)。提早出發可以避免塞車，並剛好於下午或傍晚時分抵達目的地。',
                    tips: ['跨國自駕請確認過境文件', '準備斯洛維尼亞高速公路通行證 (Vignette)']
                }
            ],
            20: [ 
                {
                    id: 'd20-1',
                    time: '06:00',
                    title: '抵達台灣',
                    type: 'arrival',
                    iconName: 'MapPin',
                    note: '平安回家',
                    location: '桃園國際機場',
                    desc: '旅程結束，帶著滿滿的回憶回到溫暖的家。',
                    tips: ['整理照片', '補眠調整時差']
                }
            ]
        };

        const getDayEvents = (dayNum) => {
            if (itineraryData[dayNum]) return itineraryData[dayNum];
            
            return [
                {
                    id: `gen-${dayNum}-1`,
                    time: '09:30',
                    title: '城市探索',
                    type: 'sightseeing',
                    iconName: 'Camera',
                    location: 'City Center',
                    desc: '享受當地的早晨氛圍，探索巷弄間的驚喜。',
                    tips: ['尋找當地咖啡館', '購買紀念品']
                },
                {
                    id: `gen-${dayNum}-2`,
                    time: '13:00',
                    title: '當地美食饗宴',
                    type: 'food',
                    iconName: 'Utensils',
                    location: 'Local Restaurant',
                    desc: '品嚐西巴爾幹半島的特色料理，如烤肉卷 (Ćevapi) 或布雷克餅 (Burek)。',
                    tips: ['嘗試當地啤酒或葡萄酒']
                },
                {
                    id: `gen-${dayNum}-3`,
                    time: '16:00',
                    title: '午後休憩',
                    type: 'relax',
                    iconName: 'Coffee',
                    location: 'Old Town Cafe',
                    desc: '在露天咖啡座休息，觀察路人，享受悠閒的歐洲步調。',
                    tips: []
                }
            ];
        };

        // --- Main Components ---

        const DetailView = ({ item, onClose }) => {
            if (!item) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none">
                    {/* Backdrop */}
                    <div 
                        className="absolute inset-0 bg-black/40 backdrop-blur-sm pointer-events-auto transition-opacity duration-300"
                        onClick={onClose}
                    />
                    
                    {/* Card Content */}
                    <div className="relative w-full max-w-md h-[85vh] sm:h-[600px] bg-[#FDFCF8] rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-hidden pointer-events-auto flex flex-col transform transition-transform duration-300 ease-out translate-y-0 animate-fade-in">
                        
                        {/* Header Bar */}
                        <div className="flex items-center justify-between p-4 border-b border-gray-100 bg-white/80 backdrop-blur-md sticky top-0 z-10">
                            <button 
                                onClick={onClose}
                                className="p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors text-gray-600"
                            >
                                <Icon name="ChevronLeft" size={24} />
                            </button>
                            
                            <h2 className={`text-lg font-serif font-bold ${MORANDI_COLORS.text} truncate flex-1 text-center px-2`}>
                                {item.title}
                            </h2>

                             <div className="w-8"></div>
                        </div>

                        {/* Content */}
                        <div className="flex-1 overflow-y-auto p-6 pt-6">
                            
                            <div className="flex flex-col items-center gap-4 mb-6">
                                {/* Time Badge */}
                                <div className="flex items-center gap-2">
                                     <span className={`px-3 py-1 rounded-full text-xs font-medium ${MORANDI_COLORS.primary} text-white`}>
                                        {item.time}
                                    </span>
                                     <span className="text-xs text-gray-400 uppercase tracking-wider bg-gray-100 px-2 py-1 rounded-md">{item.type}</span>
                                </div>
                                
                                {/* Location (with inline Map Link) */}
                                <div className="flex items-center justify-center gap-2 text-sm text-gray-500">
                                    <Icon name="MapPin" size={16} className="flex-shrink-0" />
                                    <span>{item.location}</span>
                                    <MapLink url={item.mapLink || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}`} />
                                </div>
                            </div>

                            <div className="prose prose-sm mb-8">
                                <h3 className={`text-lg font-medium mb-3 ${MORANDI_COLORS.highlight}`}>關於此行程</h3>
                                <div className="text-gray-600 leading-relaxed text-justify">
                                    {item.desc}
                                </div>
                            </div>

                            {item.tips && item.tips.length > 0 && (
                                <div className={`p-5 rounded-2xl ${MORANDI_COLORS.accent} bg-opacity-30 mb-8`}>
                                    <h3 className={`text-sm font-bold mb-3 flex items-center gap-2 ${MORANDI_COLORS.text}`}>
                                        <Icon name="Star" size={16} /> 貼心小提醒
                                    </h3>
                                    <ul className="space-y-2">
                                        {item.tips.map((tip, idx) => (
                                            <li key={idx} className="flex items-start gap-2 text-sm text-gray-700">
                                                <span className="mt-1.5 w-1.5 h-1.5 rounded-full bg-gray-400 flex-shrink-0" />
                                                {tip}
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                            
                            {/* Bottom Button Removed */}
                        </div>
                    </div>
                </div>
            );
        };

        const InfoPage = () => {
            return (
                <div className="p-6 pb-24 space-y-6 animate-fade-in">
                    <h2 className={`text-2xl font-serif font-bold ${MORANDI_COLORS.text}`}>旅遊資訊</h2>
                    
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div className="flex items-center gap-3 mb-4">
                            <div className="text-gray-400"><Icon name="Plane" size={24}/></div>
                            <h3 className="font-bold text-lg text-gray-700">航班資訊</h3>
                        </div>
                        <div className="space-y-4">
                            <div className="border-l-2 border-gray-200 pl-4">
                                <p className="text-xs text-gray-400">去程 5/24</p>
                                <p className="font-medium text-gray-800">TK025 TPE - IST</p>
                                <p className="text-sm text-gray-500">21:55 - 05:10 (+1)</p>
                            </div>
                            <div className="border-l-2 border-gray-200 pl-4">
                                <p className="text-xs text-gray-400">轉機 5/25</p>
                                <p className="font-medium text-gray-800">TK439 IST - DBV</p>
                                <p className="text-sm text-gray-500">07:30 - 08:20</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div className="flex items-center gap-3 mb-4">
                             <div className="text-gray-400"><Icon name="Info" size={24}/></div>
                            <h3 className="font-bold text-lg text-gray-700">行前清單</h3>
                        </div>
                        <ul className="space-y-3">
                            {['護照 (效期6個月以上)', '歐元現金', '海外旅遊保險證明', '轉接頭 (歐規雙圓孔)', '常用藥品'].map((item, i) => (
                                <li key={i} className="flex items-center gap-3 text-sm text-gray-600">
                                    <div className={`w-4 h-4 rounded border ${MORANDI_COLORS.primary} flex items-center justify-center`}>
                                        <div className={`w-2 h-2 rounded-sm ${MORANDI_COLORS.primary}`} />
                                    </div>
                                    {item}
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('itinerary'); 
            const [selectedDateIdx, setSelectedDateIdx] = useState(0);
            const [viewingItem, setViewingItem] = useState(null);
            const scrollRef = useRef(null);

            const currentDate = tripDates[selectedDateIdx];
            const currentEvents = getDayEvents(currentDate.dayNum);
            const currentWeather = getWeather(selectedDateIdx);

            useEffect(() => {
                if (scrollRef.current) {
                    const activeEl = scrollRef.current.children[selectedDateIdx];
                    if (activeEl) {
                        activeEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    }
                }
            }, [selectedDateIdx]);

            return (
                <div className={`min-h-screen ${MORANDI_COLORS.bg} font-sans selection:bg-[#D4C4B7] selection:text-white`}>
                    <div className="max-w-md mx-auto bg-[#FDFCF8] min-h-screen relative shadow-2xl overflow-hidden flex flex-col">
                        
                        {/* Header */}
                        <div className="pt-8 px-6 pb-4 bg-white/50 backdrop-blur-sm sticky top-0 z-10">
                            <h1 className={`text-2xl font-serif font-bold ${MORANDI_COLORS.text} tracking-wide`}>
                                西巴爾幹之旅
                            </h1>
                            <p className="text-xs text-gray-500 mt-1 tracking-widest uppercase">
                                2026 MAY 24 - JUN 12
                            </p>
                        </div>

                        {activeTab === 'itinerary' ? (
                            <React.Fragment>
                                {/* Date Selector */}
                                <div className="border-b border-gray-200 bg-white shadow-sm z-0">
                                    <div 
                                        ref={scrollRef}
                                        className="flex overflow-x-auto px-0 hide-scrollbar snap-x"
                                    >
                                        {tripDates.map((d, idx) => {
                                            const isActive = idx === selectedDateIdx;
                                            return (
                                                <button
                                                    key={idx}
                                                    onClick={() => setSelectedDateIdx(idx)}
                                                    className={`snap-center flex-shrink-0 flex flex-col items-center justify-center w-16 h-16 transition-colors duration-200 border-r border-gray-50 last:border-0 ${
                                                        isActive 
                                                            ? `${MORANDI_COLORS.primary} text-white` 
                                                            : 'bg-white text-gray-400 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    <span className="text-[10px] font-medium opacity-80 uppercase tracking-wider">{d.weekDay}</span>
                                                    <span className="text-lg font-bold leading-none my-0.5">{d.dateObj.getDate()}</span>
                                                    <span className="text-[9px] opacity-60">D{d.dayNum}</span>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Scrollable Content */}
                                <div className="flex-1 overflow-y-auto pb-24">
                                    
                                    {/* Weather Display */}
                                    <div className="px-6 pt-4 pb-2 flex justify-end">
                                        <div className={`flex items-center gap-1.5 px-3 py-1 rounded-full ${MORANDI_COLORS.bg} border border-gray-100 shadow-sm`}>
                                            <div className={currentWeather.color}>
                                                <Icon name={currentWeather.icon} size={16} />
                                            </div>
                                            <span className={`text-sm font-bold ${MORANDI_COLORS.text}`}>{currentWeather.temp}°</span>
                                            <span className="text-xs text-gray-400">{currentWeather.desc}</span>
                                        </div>
                                    </div>

                                    {/* Itinerary List */}
                                    <div className="px-6 space-y-2">
                                        {currentEvents.map((item, idx) => (
                                            <div 
                                                key={item.id}
                                                onClick={() => setViewingItem(item)}
                                                className="group bg-white rounded-xl p-5 shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] border border-gray-50 hover:shadow-lg transition-all duration-300 cursor-pointer relative overflow-hidden"
                                            >
                                                <div className="flex items-start gap-4">
                                                    {/* Time Column */}
                                                    <div className={`flex-shrink-0 w-14 pt-1 text-right text-sm font-bold font-serif ${MORANDI_COLORS.highlight}`}>
                                                        {item.time}
                                                    </div>

                                                    {/* Content Column */}
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex justify-between items-start mb-0.5">
                                                            <h3 className={`text-lg font-bold ${MORANDI_COLORS.text} leading-tight`}>
                                                                {item.title}
                                                            </h3>
                                                            
                                                            {/* Map Button on Card */}
                                                            <button 
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    const url = item.mapLink || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}`;
                                                                    window.open(url, '_blank');
                                                                }}
                                                                className={`ml-2 p-1.5 rounded-full ${MORANDI_COLORS.bg} text-gray-400 hover:text-[#C78F76] hover:bg-[#FFF] transition-colors flex-shrink-0`}
                                                            >
                                                                <div className="w-4 h-4 flex items-center justify-center rounded-tr-[50%] rounded-tl-[50%] rounded-bl-[50%] rounded-br-0 transform rotate-45 border-2 border-current">
                                                                    <div className="w-1 h-1 bg-current rounded-full transform -rotate-45" />
                                                                </div>
                                                            </button>
                                                        </div>
                                                        
                                                        {/* Subtitle / Location */}
                                                        <p className="text-sm text-gray-500 line-clamp-2">
                                                            {item.subtitle || item.location}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}

                                        <div className="h-10 text-center text-xs text-gray-300 pt-4">
                                            End of Day {currentDate.dayNum}
                                        </div>
                                    </div>
                                </div>
                            </React.Fragment>
                        ) : (
                            <InfoPage />
                        )}

                        {/* Bottom Navigation */}
                        <div className="absolute bottom-6 left-6 right-6">
                            <div className="bg-white/90 backdrop-blur-md rounded-full shadow-[0_8px_30px_rgb(0,0,0,0.08)] p-1.5 flex justify-between border border-white/50">
                                <button
                                    onClick={() => setActiveTab('itinerary')}
                                    className={`flex-1 py-3 rounded-full flex items-center justify-center gap-2 text-sm font-medium transition-all duration-300 ${
                                        activeTab === 'itinerary' 
                                            ? `${MORANDI_COLORS.primary} text-white shadow-md` 
                                            : 'text-gray-400 hover:bg-gray-50'
                                    }`}
                                >
                                    <Icon name="Calendar" size={18} />
                                    每日行程
                                </button>
                                <button
                                    onClick={() => setActiveTab('info')}
                                    className={`flex-1 py-3 rounded-full flex items-center justify-center gap-2 text-sm font-medium transition-all duration-300 ${
                                        activeTab === 'info' 
                                            ? `${MORANDI_COLORS.primary} text-white shadow-md` 
                                            : 'text-gray-400 hover:bg-gray-50'
                                    }`}
                                >
                                    <Icon name="Info" size={18} />
                                    旅遊資訊
                                </button>
                            </div>
                        </div>

                        {/* Details Overlay */}
                        <DetailView item={viewingItem} onClose={() => setViewingItem(null)} />

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


